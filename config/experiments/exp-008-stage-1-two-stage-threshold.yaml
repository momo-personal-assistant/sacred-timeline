# EXP-008 Stage 1: Two-Stage Threshold
# SuperMemory pattern: chunk threshold + document threshold
# Goal: Reduce false positives by filtering project pairs with inconsistent similarity

name: "exp-008-stage-1-two-stage-threshold"
description: "Two-stage threshold: chunk-level + document-level filtering (SuperMemory pattern)"
created_at: "2025-11-27"

embedding:
  model: "text-embedding-3-small"
  dimensions: 1536
  batchSize: 100

chunking:
  strategy: "semantic"
  maxChunkSize: 500
  overlap: 50
  preserveMetadata: true

retrieval:
  similarityThreshold: 0.30
  chunkLimit: 20
  includeRelations: true
  relationDepth: 1

relationInference:
  # Stage 1: Chunk-level threshold (same as EXP-007)
  similarityThreshold: 0.30
  keywordOverlapThreshold: 0.65
  includeInferred: true
  useSemanticSimilarity: true
  semanticWeight: 0.7

  # EXP-006: Project metadata signal
  useProjectMetadata: true
  projectWeight: 0.25

  # EXP-007: Schema-based signal
  useSchemaSignal: true
  schemaWeight: 0.20

  # EXP-008 Stage 1: Two-stage threshold (NEW)
  useDocumentThreshold: true
  documentThreshold: 0.25  # Average similarity across project pairs must exceed this
  minChunkMatches: 1       # Minimum matches required per project pair

validation:
  runOnSave: true
  autoSaveExperiment: true
  scenarios:
    - "normal"

metadata:
  baseline: false
  experiment_series: "EXP-008"
  stage: "1-two-stage-threshold"
  hypothesis: "Document-level threshold filters noise from single high-scoring pairs between unrelated projects"
  baseline_f1: 86.0  # From EXP-007
  target_f1: 88
  target_precision: 80
  formula: |
    Stage 1: score = 0.385*semantic + 0.165*keyword + 0.25*project + 0.20*schema (threshold >= 0.30)
    Stage 2: avg_score(project_pair) >= 0.25
  expected_improvement: "Precision +4-6%, F1 +1-2%"
  supermemory_reference: "Two-stage filtering pattern from SuperMemory implementation"
